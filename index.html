<!DOCTYPE html>
<html>
<body>

<h2>Select a Subreddit</h2>

<select id="subreddit">
    <option value="Anxiety">Anxiety</option>
    <option value="depression">depression</option>
    <option value="bipolar">bipolar</option>
    <option value="mentalillness">mentalillness</option>
    <option value="BPD">BPD</option>
    <option value="schizophrenia">schizophrenia</option>
</select>

<button onclick="loadPosts()">Load Posts</button>

<div id="posts"></div>

<script>
async function loadPosts() {
    const subreddit = document.getElementById("subreddit").value;

    // âœ… Correct URL for Flask Backend
    const res = await fetch(`http://localhost:8080/reddit/${subreddit}`);

    const posts = await res.json();

    let html = "";

    posts.forEach((p) => {
        html += `
        <div style="border:1px solid #ccc; margin:10px; padding:10px;">
            <h3>${p.title}</h3>
            <p>${p.text}</p>
            <button onclick="analyze('${encodeURIComponent(p.text)}')">
                Analyze
            </button>
        </div>`;
    });

    document.getElementById("posts").innerHTML = html;
}

async function analyze(text) {
    const res = await fetch(`http://localhost:8080/analyze`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: decodeURIComponent(text) })
    });

    const result = await res.json();

    alert(
        "Prediction: " + result.prediction +
        "\nConfidence: " + result.confidence +
        "\nSentiment: " + JSON.stringify(result.sentiment)
    );
}
</script>

</body>
</html>
